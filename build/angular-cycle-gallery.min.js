(function(){angular.module("multiGallery",[])}).call(this),function(){angular.module("multiGallery").directive("galleryButton",["GalleryActions",function(t){return{restrict:"A",link:function(e,n,r){var o;return o=r.galleryButton,n.on("click",function(){return t[o]()})}}}])}.call(this),function(){angular.module("multiGallery").directive("galleryRepeater",["GalleryRenderer","ItemsStorage","MoverHolder","GalleryMover","GalleryEvents","$rootScope",function(t,e,n,r,o,i){return{terminal:!0,transclude:"element",terminal:!0,$$tlb:!0,priority:1e3,link:function(s,u,p,a,h){var l,c,d,_,f,m,y,I,g,x,v,P,E,R;return m=p.galleryRepeater,f=m.match(/^\s*(.+)\s+in\s+(.*?)\s*(\s+track\s+by\s+(.+)\s*)?$/),y=f[1],d=f[2],_="$galleryIndex",c=u.parent(),l=angular.element(document).find("body"),E=new e,I=new t(s,y,c,h),g=new n(c),x=new r(E,I,g,s),o.on("move:next",function(){return x.next()}),o.on("move:prev",function(){return x.prev()}),o.on("animate:next",function(){return x.animateNext()}),o.on("animate:prev",function(){return x.animatePrev()}),o.on("index:update",function(){return s[_]=E.getIndex()}),s.$watchCollection(d,function(t){return x.render(t)}),R=!1,P=0,v=0,c.on("mousedown",function(t){return R=!0,P=t.x}),l.on("mouseup",function(){return R=!1}),l.on("mousemove",function(t){var e;return R?(console.log("SLIDE",v,e),e=t.x-P,x.touchMove(e)):!0}),i.setGalleryIndex=function(t){return x.setIndex(t-0)}}}}])}.call(this),function(){angular.module("multiGallery").service("GalleryActions",["GalleryEvents",function(t){return{next:function(){return t["do"]("move:next")},prev:function(){return t["do"]("move:prev")},animateNext:function(){return t["do"]("animate:next")},animatePrev:function(){return t["do"]("animate:prev")}}}])}.call(this),function(){angular.module("multiGallery").service("CycleGenerator",function(){var t,e;return t=0,e=function(){function e(){}return e.prototype._count=0,e.prototype._items=[],e.prototype._cycleItems=[],e.prototype.setItems=function(t){return this._items=t,this._count=t.length,this._cycleItems=[],this._cycleGenerate(1)},e.prototype.sliceItems=function(t,e){return e>this._cycleItems.length-1&&this._cycleGenerate(Math.ceil(e/this._count)),this._cycleItems.slice(t,e)},e.prototype._cycleGenerate=function(t){var e,n,r,o,i;for(i=[],e=r=0,o=t;o>=0?o>=r:r>=o;e=o>=0?++r:--r)n=JSON.parse(JSON.stringify(this._items)),i.push(this._cycleItems=this._cycleItems.concat(this._addUIID(n)));return i},e.prototype._addUIID=function(e){var n,r,o;for(r=0,o=e.length;o>r;r++)n=e[r],n._$UUID=++t;return e},e}()})}.call(this),function(){angular.module("multiGallery").service("GalleryEvents",[function(){return{_stack:{},on:function(t,e){return this._stack[t]||(this._stack[t]=[]),this._stack[t].push(e)},"do":function(t){var e,n,r,o,i;if(this._stack[t]){for(o=this._stack[t],i=[],n=0,r=o.length;r>n;n++)e=o[n],i.push(e());return i}}}}])}.call(this),function(){angular.module("multiGallery").service("GalleryRenderer",["RenderedItems",function(t){var e;return e=function(){function e(t,e,n,r){this._$scope=t,this._scopeItemName=e,this._$holder=n,this._transcludeFunction=r}return e.prototype._renderedItems=new t,e.prototype._transcludeFunction=null,e.prototype._$scope=null,e.prototype._scopeItemName=null,e.prototype._$holder=null,e.prototype.render=function(t){return this._renderedItems.markAllOutdated(),this._updateRenderedPosition(t),this._renderedItems.removeOutdated(),this._updateHolder()},e.prototype.getRenderedCount=function(){return this._renderedItems.getCount()},e.prototype.firstElement=function(){return this._renderedItems.firstElement()},e.prototype.getElementByIndex=function(t){return this._$holder.children().eq(t)[0]},e.prototype.getRightElementsCount=function(t){return this.getRenderedCount()-this.getElementIndex(t)},e.prototype.getElementIndex=function(t){var e;for(e=0;null!==(t=t.previousSibling);)++e;return e},e.prototype._updateRenderedPosition=function(t){var e,n,r,o,i;for(i=[],e=r=0,o=t.length;o>r;e=++r)n=t[e],i.push(this._renderedItems.addItem(e,n));return i},e.prototype._updateHolder=function(){var t,e,n,r,o,i;for(o=this._renderedItems.getItemsForRender(),i=[],n=0,r=o.length;r>n;n++)e=o[n],t=this._newItemScope(e.getData()),i.push(this._transcludeFunction(t,function(n){return function(r){return e.setRenderData(t,r),n._appendItem(e,r)}}(this)));return i},e.prototype._appendItem=function(t,e){return 0===t.getIndex()?this._$holder.prepend(e):this._renderedItems.getElementByIndex(t.getIndex()-1).after(e)},e.prototype._newItemScope=function(t){var e;return e=this._$scope.$new(),e[this._scopeItemName]=t,e},e}()}])}.call(this),function(){angular.module("multiGallery").service("ItemsStorage",["CycleGenerator","GalleryEvents",function(t,e){var n;return n=function(){function n(){}return n.prototype.NEAREST_ITEMS=2,n.prototype.items=[],n.prototype.index=0,n.prototype.count=0,n.prototype.nextBuffer=0,n.prototype.prevBuffer=0,n.prototype.cycleMultiplier=0,n.prototype.nextCycleItems=new t,n.prototype.prevCycleItems=new t,n.prototype.setItems=function(t){return this.count=t.length,this.items=t,this.nextCycleItems.setItems(this.items),this.prevCycleItems.setItems(this.items),this.setIndex(0)},n.prototype.getNearestRange=function(){return 0===this.count?[]:[].concat(this.getPrevRangeItems(),this.getNextRangeItems())},n.prototype.getIndex=function(){return this.index},n.prototype.getPrevRangeItems=function(){var t,e,n,r;return n=this.NEAREST_ITEMS+this.prevBuffer,t=((n+this.index)/this.count|0)+1,e=this.count*t-n+this.index,r=e+n,this.prevCycleItems.sliceItems(e,r)},n.prototype.getNextRangeItems=function(){var t,e,n;return e=this.NEAREST_ITEMS+this.nextBuffer,t=this.index,n=t+e+1,this.nextCycleItems.sliceItems(t,n)},n.prototype.nextIndex=function(){return this.setIndex(this.index+1)},n.prototype.prevIndex=function(){return this.setIndex(this.index-1)},n.prototype.getCurrentIndexInRange=function(){return this.NEAREST_ITEMS-this.prevBuffer+this.nextBuffer},n.prototype.clearRangeBuffer=function(){return this._clearNextBuffer(),this._clearPrevBuffer()},n.prototype.incNextBuffer=function(){return++this.nextBuffer},n.prototype.getNextBuffer=function(){return this.nextBuffer},n.prototype.incPrevBuffer=function(){return++this.prevBuffer},n.prototype.getPrevBuffer=function(){return this.prevBuffer},n.prototype._clearNextBuffer=function(){return this.setIndex(this.index+this.nextBuffer),this.nextBuffer=0},n.prototype._clearPrevBuffer=function(){return this.setIndex(this.index-this.prevBuffer),this.prevBuffer=0},n.prototype.setIndex=function(t){var n;return n=this._fixIndex(t),this.index!==n?(this.index=n,e["do"]("index:update")):void 0},n.prototype._fixIndex=function(t){return t>=this.count&&this.count>0&&(t%=this.count),0>t&&(t=this.count+t),t>=0&&t<this.count||0===this.count||(t=this._fixIndex(t)),t},n}()}])}.call(this),function(){angular.module("multiGallery").service("GalleryMover",function(){var t;return t=function(){function t(t,e,n,r){this._storage=t,this._renderer=e,this._holder=n,this._$scope=r}return t.prototype.ANIMATION_TIME=300,t.prototype.ANIMATION_SIDE_NEXT=1,t.prototype.ANIMATION_SIDE_PREV=2,t.prototype._storage=null,t.prototype._renderer=null,t.prototype._holder=null,t.prototype._$scope=null,t.prototype._animation=null,t.prototype._checked_position=null,t.prototype._itemWidth=0,t.prototype._moveIndex=0,t.prototype.render=function(t){return this._storage.setItems(t),this._renderer.render(this._storage.getNearestRange()),this._holder.update(),this._syncMoveIndex(),this._applyCurrentIndexPosition()},t.prototype.setIndex=function(t){return this._animation_side?this._stopAnimationSide():(this._storage.setIndex(t),this._syncMoveIndex(),this._stopPreviusAnimation(),this._rerender())},t.prototype.next=function(){return this._animation_side?this._stopAnimationSide():(this._storage.nextIndex(),this._syncMoveIndex(),this._rerender())},t.prototype.prev=function(){return this._animation_side?this._stopAnimationSide():(this._storage.prevIndex(),this._syncMoveIndex(),this._rerender())},t.prototype.animateNext=function(){return this._animation_side===this.ANIMATION_SIDE_PREV?this._stopAnimationSide():(this._storage.incNextBuffer(),this._animate())},t.prototype.animatePrev=function(){return this._animation_side===this.ANIMATION_SIDE_NEXT?this._stopAnimationSide():(this._storage.incPrevBuffer(),this._animate())},t.prototype.touchMove=function(t){return this._holder.setPosition(this._getPositionForMoveIndex()-t)},t.prototype.touchEnd=function(){},t.prototype._defaultAnimationTime=function(){return this.ANIMATION_TIME/1e3},t.prototype._stopPreviusAnimation=function(){return this._animation&&this._animation.pause(),this._animation?this._animation.kill():void 0},t.prototype._stopAnimationSide=function(){return this._stopPreviusAnimation(),this._animation_side=null,this._storage.clearRangeBuffer(),this._syncMoveIndex(),this._rerender()},t.prototype._animate=function(t,e){return null==t&&(t=this._defaultAnimationTime()),null==e&&(e=this._getPositionForCurrentIndex()),this._stopPreviusAnimation(),this._animation=TweenMax.to(this._holder.getElement(),t,{left:e+"px",ease:Linear.easeNone,onUpdate:function(t){return function(){return t._checkFrameChange()}}(this),onComplete:function(t){return function(){return t._onCompleteAnimation()}}(this)})},t.prototype._onCompleteAnimation=function(){return this._detectPositionClear(),this._storage.clearRangeBuffer(),this._syncMoveIndex(),this._rerender()},t.prototype._detectPosition=function(){var t;return this._holder.createPositionLock(),t=this._holder.getPositionLockDiff(),Math.abs(t)>5?(this._animation_side=0>t?this.ANIMATION_SIDE_NEXT:this.ANIMATION_SIDE_PREV,!0):!1},t.prototype._detectPositionClear=function(){return this._holder.clearPositionLock(),this._animation_side=null},t.prototype._checkFrameChange=function(){var t,e,n,r,o;if(this._detectPosition())return(e=this._holder.getDisplayIndex())===this._getMoveIndex()?!1:(this._stopPreviusAnimation(),t=this._renderer.getElementByIndex(e),o=this._renderer.getRightElementsCount(t),this._animationRender(),r=this._renderer.getRightElementsCount(t),this._animation_side===this.ANIMATION_SIDE_NEXT?(this._moveIndex++,n=this._getPositionForCurrentIndex()):(this._moveIndex=this._renderer.getRenderedCount()-o,n=this._holder.__calculatePositionForIndex(this._storage.NEAREST_ITEMS),this._holder.setPosition(this._getPositionForMoveIndex()+this._holder.getSlideDiff())),this._detectPositionClear(),this._animate(null,n))},t.prototype._applyMoveIndexPosition=function(){return this._holder.setPosition(this._getPositionForMoveIndex())},t.prototype._applyCurrentIndexPosition=function(){return this._holder.setPosition(this._getPositionForCurrentIndex())},t.prototype._getPositionForMoveIndex=function(){return this._holder.__calculatePositionForIndex(this._getMoveIndex())},t.prototype._getPositionForCurrentIndex=function(){return this._holder.__calculatePositionForIndex(this._storage.getCurrentIndexInRange())},t.prototype._syncMoveIndex=function(){return this._moveIndex=this._storage.getCurrentIndexInRange()},t.prototype._getMoveIndex=function(){return this._moveIndex},t.prototype._animationRender=function(){return this._renderer.render(this._storage.getNearestRange()),this._$scope.$apply()},t.prototype._rerender=function(){return this._renderer.render(this._storage.getNearestRange()),this._applyMoveIndexPosition(),this._$scope.$$phase?void 0:this._$scope.$apply()},t}()})}.call(this),function(){angular.module("multiGallery").service("RenderedItem",function(){var t;return t=function(){function t(t,e){this._index=t,this._data=e,this._outdate=!1}return t.prototype._index=null,t.prototype._data=null,t.prototype._element=null,t.prototype._scope=null,t.prototype._outdate=null,t.prototype._rendered=!1,t.prototype.getIndex=function(){return this._index},t.prototype.isDataMatch=function(t){return this._data._$UUID===t._$UUID},t.prototype.getData=function(){return this._data},t.prototype.getElement=function(){return this._element},t.prototype.updateRenderIndex=function(t){return this._index=t,this._outdate=!1,this._rendered=!0},t.prototype.setRenderData=function(t,e){return this._scope=t,this._element=e,this._outdate=!1,this._rendered=!0},t.prototype.destroy=function(){return this._element.remove(),this._scope.$destroy()},t.prototype.isOutdate=function(){return this._outdate},t.prototype.markOutdated=function(){return this._outdate=!0},t.prototype.isWaitingForRender=function(){return this._outdate===!1&&this._rendered===!1},t}()})}.call(this),function(){angular.module("multiGallery").service("RenderedItems",["RenderedItem",function(t){var e;return e=function(){function e(){}return e.prototype._items=[],e.prototype.addItem=function(e,n){var r,o,i,s;for(s=this._items,o=0,i=s.length;i>o;o++)if(r=s[o],r.isDataMatch(n))return r.updateRenderIndex(e),!0;return this._items.push(new t(e,n))},e.prototype.getCount=function(){return this._items.length},e.prototype.getItemsForRender=function(){var t,e,n,r,o;for(e=[],o=this._items,n=0,r=o.length;r>n;n++)t=o[n],t.isWaitingForRender()&&e.push(t);return e},e.prototype.markAllOutdated=function(){var t,e,n,r,o;for(r=this._items,o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push(t.markOutdated());return o},e.prototype.removeOutdated=function(){var t,e,n,r,o,i,s,u,p;for(e=[],u=this._items,t=r=0,i=u.length;i>r;t=++r)n=u[t],n.isOutdate()&&(e.unshift(t),n.destroy());for(p=[],o=0,s=e.length;s>o;o++)t=e[o],p.push(this._items.splice(t,1));return p},e.prototype.firstElement=function(){return this.getElementByIndex(0)},e.prototype.getElementByIndex=function(t){var e,n,r,o;for(o=this._items,n=0,r=o.length;r>n;n++)if(e=o[n],e.getIndex()===t)return e.getElement()},e}()}])}.call(this),function(){angular.module("multiGallery").service("MoverHolder",function(){var t;return t=function(){function t(t){this._$holder=t}return t.prototype._$holder=null,t.prototype._itemWidth=0,t.prototype._position_lock=null,t.prototype.update=function(){return this.getItemWidth(!1)},t.prototype.getElement=function(){return this._$holder},t.prototype.getDisplayIndex=function(){return Math.abs(Math.round(this.getCurrentPosition()/this.getItemWidth()))},t.prototype.getItemWidth=function(t){var e;return null==t&&(t=!0),this._itemWidth&&t?this._itemWidth:(e=this._$holder.children().eq(0),e[0]?this._itemWidth=e[0].offsetWidth:void 0)},t.prototype.getCurrentPosition=function(){return parseInt(this._$holder.css("left"),10)},t.prototype.setPosition=function(t){return this._$holder.css("left",t+"px")},t.prototype.getSlideDiff=function(){return this.getCurrentPosition()%this.getItemWidth()},t.prototype.__calculatePositionForIndex=function(t){return this.getItemWidth()*t*-1},t.prototype.createPositionLock=function(){return this._position_lock?void 0:this._position_lock=this.getCurrentPosition()},t.prototype.getPositionLockDiff=function(){return this.getCurrentPosition()-this._position_lock},t.prototype.clearPositionLock=function(){return this._position_lock=null},t}()})}.call(this);